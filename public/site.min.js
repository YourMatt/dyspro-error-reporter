var current_environment,app=angular.module("ErrorReporter",[]);$(document).ready(function(){}),app.controller("DashboardController",["$scope",function(n){n.error_occurrences=[],n.changeEnvironmentTab=function(e){current_environment=$(e.currentTarget).parent().attr("environment"),$(".nav-tabs li").removeClass("active"),$(e.currentTarget).parent().addClass("active"),this.reloadErrorOccurrences()},n.reloadErrorOccurrences=function(){current_environment||(current_environment=$(".nav-tabs li.active").attr("environment")),$.ajax("/api/errors/"+current_environment+"/20").done(function(e){if(e.error)console.log("Error: "+e.error);else{n.error_occurrences=[];for(var r=0;r<e.length;r++){var t=new ErrorOccurrence;t.error_occurrence_id=e[r].ErrorOccurrenceId,t.environment=e[r].Environment,t.message=e[r].Message,t.server=e[r].Server,t.user_name=e[r].UserName,t.date=moment(e[r].Date),t.error.error_id=e[r].ErrorId,t.error.account_id=e[r].AccountId,t.error.product=e[r].ProductName,t.error.stack_trace=e[r].StackTrace,n.error_occurrences.push(t)}n.$apply(),$("#RecentErrors").removeClass("hidden")}})},n.reloadErrorOccurrences()}]);var Error=function(){this.error_id=0,this.account_id=0,this.product="",this.stack_trace=""},ErrorOccurrence=function(){this.error=new Error,this.error_occurrence_id=0,this.environment="",this.message="",this.server="",this.user_name="",this.date=0,this.attachments=[]},ErrorAttachment=function(){this.file_name="",this.file_type=""},ErrorOccurrenceStats=function(){this.num_occurrences=0,this.date_first_occurrence=0,this.date_last_occurrence=0,this.all_on_single_day=!1};app.controller("ErrorHistoryController",["$scope",function(o){o.error_occurrences=[];var e="",r=$("environment","#error-occurrence-metadata").text();if(r){var t=$("errorid","#error-occurrence-metadata").text();e="/api/errors/"+r+"/"+t}else void 0!==current_environment&&(e="/api/errors/"+current_environment);e&&(o.reloadErrorOccurrences=function(){$.ajax(e).done(function(e){if(e.error)console.log("Error: "+e.error);else{o.error_occurrences=[];for(var r=new ErrorOccurrenceStats,t=0;t<e.length;t++){var n=new ErrorOccurrence;n.error_occurrence_id=e[t].ErrorOccurrenceId,n.environment=e[t].Environment,n.message=e[t].Message,n.server=e[t].Server,n.user_name=e[t].UserName,n.date=moment(e[t].Date),n.error.error_id=e[t].ErrorId,n.error.account_id=e[t].AccountId,n.error.product=e[t].Product,n.error.stack_trace=e[t].StackTrace,o.error_occurrences.push(n),r.num_occurrences++,(!r.date_first_occurrence||moment(e[t].Date)<r.date_first_occurrence)&&(r.date_first_occurrence=moment(e[t].Date)),moment(e[t].Date)>r.date_last_occurrence&&(r.date_last_occurrence=moment(e[t].Date))}r.date_first_occurrence.format("MMDDYYYY")==r.date_last_occurrence.format("MMDDYYYY")&&(r.all_on_single_day=!0),o.error_occurrence_stats=r,o.$apply(),$("#RecentErrors").removeClass("hidden")}})},o.reloadErrorOccurrences())}]),$(document).ready(function(){}),app.controller("SettingsController",["$scope",function(e){e.user={},e.isUserFormSubmitDisabled=!0,e.monitors=[],e.products=[],e.environments=[],e.monitor={},e.monitorTestResults={},e.isMonitorFormSubmitDisabled=!0,e.saveUser=settingsPage.userForm.saveUser,e.saveMonitor=settingsPage.monitorForm.saveMonitor,settingsPage.init(e)}]);var settingsPage={angularScope:null,init:function(e){settingsPage.angularScope=e,settingsPage.userForm.userId=$("userid","#account-metadata").text(),settingsPage.userForm.loadUser(),settingsPage.monitorForm.loadMonitors(),settingsPage.monitorForm.loadProducts(),settingsPage.monitorForm.loadEnvironments(),settingsPage.monitorForm.initializeForm()},updateAngularValue:function(e){e();var r=settingsPage.angularScope.$root.$$phase;"$apply"!==r&&"$digest"!==r&&settingsPage.angularScope.$apply()},userForm:{userId:0,originalEmailAddress:"",formEnableSubmit:function(){settingsPage.updateAngularValue(function(){settingsPage.angularScope.isUserFormSubmitDisabled=!1})},formDisableSubmit:function(){settingsPage.updateAngularValue(function(){settingsPage.angularScope.isUserFormSubmitDisabled=!0})},initializeForm:function(){$("#setting-user-phone").mask("000-000-0000"),$("#setting-user-phone").val($("#setting-user-phone").masked()),settingsPage.userForm.formEnableSubmit()},getUserDataForSave:function(e){var r={name:e.name,email:e.email,phone:$("#setting-user-phone").cleanVal()},t=$("#setting-user-password-new").val();return t&&(r.password=t),r},loadUser:function(){$.ajax("/api/user/"+settingsPage.userForm.userId).done(function(e){settingsPage.userForm.originalEmailAddress=e.email,settingsPage.updateAngularValue(function(){settingsPage.angularScope.user=e}),settingsPage.userForm.initializeForm()}).fail(function(e){notifications.errorFromServiceResponse(e)})},saveUser:function(){settingsPage.userForm.isFormUserValidated()&&(settingsPage.userForm.formDisableSubmit(),$.ajax({type:"put",url:"/api/user/"+settingsPage.userForm.userId,data:settingsPage.userForm.getUserDataForSave(settingsPage.angularScope.user)}).done(function(e){$("#setting-user-password-current").val(""),$("#setting-user-password-new").val(""),settingsPage.userForm.originalEmailAddress=$("#setting-user-email").val(),notifications.success("Successfully saved your user information.")}).fail(function(e){notifications.errorFromServiceResponse(e)}).always(function(){settingsPage.userForm.formEnableSubmit()}))},isFormUserValidated:function(){var e="",r=$("#setting-user-phone").val();r.length&&12!==r.length&&(e="Invalid phone number."),$("#setting-user-phone")[0].setCustomValidity(e);var t=$("#setting-user-password-current").val();if(t?$.ajax({async:!1,type:"post",url:"/api/user/authenticate",data:{email:settingsPage.userForm.originalEmailAddress,password:t}}).done(function(){$("#setting-user-password-current")[0].setCustomValidity("")}).fail(function(){$("#setting-user-password-current")[0].setCustomValidity("Your original password is incorrect.")}):$("#setting-user-password-new").val(""),!1===$("#form-user")[0].checkValidity())return!1;var n=$("#setting-user-password-new").val();if(n){var o=$("#setting-user-password-new-confirm").val();if(!o)return $("#modal-password-confirm").on("shown.bs.modal",function(e){$("#setting-user-password-new-confirm").focus()}),$("#modal-password-confirm").modal(),!1;var s="";if(o!==n&&(s="Your password does not match what was entered."),$("#setting-user-password-new-confirm")[0].setCustomValidity(s),!1===$("#form-password-confirm")[0].checkValidity())return!1;$("#modal-password-confirm").modal("hide")}return!0}},monitorForm:{originalMonitorEndpointUri:"",formEnableSubmit:function(){settingsPage.updateAngularValue(function(){settingsPage.angularScope.isMonitorFormSubmitDisabled=!1})},formDisableSubmit:function(){settingsPage.updateAngularValue(function(){settingsPage.angularScope.isMonitorFormSubmitDisabled=!0})},initializeForm:function(){settingsPage.monitorForm.formEnableSubmit(),$("input[name=setting-monitor-interval]").change(function(){settingsPage.angularScope.monitor.intervalSeconds=$(this).val()}),$("#link-about-metrics").popover({content:$("#popover-content-about-metrics").html(),html:!0,placement:"bottom",trigger:"focus"})},loadMonitors:function(){$.ajax("/api/monitors").done(function(e){settingsPage.updateAngularValue(function(){settingsPage.angularScope.monitors=e})}).fail(function(e){notifications.errorFromServiceResponse(e)})},loadProducts:function(){$.ajax("/api/products").done(function(e){settingsPage.updateAngularValue(function(){settingsPage.angularScope.products=e})}).fail(function(e){notifications.errorFromServiceResponse(e)})},loadEnvironments:function(){$.ajax("/api/environments").done(function(e){settingsPage.updateAngularValue(function(){settingsPage.angularScope.environments=e})}).fail(function(e){notifications.errorFromServiceResponse(e)})},saveMonitor:function(){settingsPage.monitorForm.isFormValidated()&&(settingsPage.monitorForm.formDisableSubmit(),settingsPage.angularScope.monitor.endpointUri===settingsPage.monitorForm.originalMonitorEndpointUri?console.log("No need to test."):$.ajax("/api/monitor/test/"+encodeURIComponent(settingsPage.angularScope.monitor.endpointUri)).done(function(e){if(!e.statusCode)return settingsPage.monitorForm.formEnableSubmit(),$("#setting-monitor-endpoint-uri")[0].setCustomValidity(e.requestErrorMessage),$("#form-monitor")[0].checkValidity(),void notifications.error("The Endpoint URI cannot be used. "+e.requestErrorMessage);e.responseParsed.responseTime=e.responseMilliseconds+"ms",e.statusText=settingsPage.monitorForm.evaluateHttpStatus(e.statusCode),settingsPage.updateAngularValue(function(){settingsPage.angularScope.monitorTestResults=e}),console.log(e),$("#modal-endpoint-uri-test").on("hide.bs.modal",function(){settingsPage.monitorForm.formEnableSubmit()}).modal()}).fail(function(e){notifications.errorFromServiceResponse(e)}))},isFormValidated:function(){return $("#setting-monitor-endpoint-uri")[0].setCustomValidity(""),!1!==$("#form-monitor")[0].checkValidity()},evaluateHttpStatus:function(e){return 200<=e&&e<300?"success":400<=e&&e<600?"error":"warning"}}},notifications={success:function(e){toastr.success(e)},error:function(e){toastr.error(e)},errorFromServiceResponse:function(e){switch(e.status){case 0:return toastr.error("Error connecting to server. Please try again in a few moments.","Communication Error");case 401:return toastr.error("You were signed out after a period of inactivity. Please sign in and try again.<br/>Redirecting in <span id='notification-redirect-seconds'>5</span> seconds...","Authentication Error",{timeout:5e3,onShown:function(){var e=5;window.setInterval(function(){$("#notification-redirect-seconds").text(--e)},1e3)},onHidden:function(){document.location="/"}})}if(e.responseJSON&&e.responseJSON.error)return toastr.error(e.responseJSON.error);toastr.error("An unhandled error has occurred.",e.status+" error")}};
//# sourceMappingURL=site.min.js.map